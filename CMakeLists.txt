#
# Copyright (c) 2019 Carnegie Mellon University,
#
# All rights reserved.
#
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file. See the AUTHORS file for names of contributors.
#

#
# CMakeLists.txt  cmake for mercury-progressor
# 29-Oct-2019  chuck@ece.cmu.edu
#

#
#  general cmake flags:
#    -DCMAKE_INSTALL_PREFIX=/usr/local     -- the prefix for installing
#    -DCMAKE_BUILD_TYPE=type               -- type can be DEBUG, RELEASE, ...
#    -DCMAKE_PREFIX_PATH=/dir              -- external packages
#
#     note that CMAKE_PREFIX_PATH can be a list of directories:
#      -DCMAKE_PREFIX_PATH='/dir1;/dir2;/dir3'
#

cmake_minimum_required(VERSION 3.1)
project(deltafs-progressor C CXX)
enable_testing()

# link shared lib with full rpath
set (CMAKE_INSTALL_RPATH_USE_LINK_PATH TRUE)

# setup cache variables for ccmake
if (NOT CMAKE_BUILD_TYPE)
    set (CMAKE_BUILD_TYPE Release
         CACHE STRING "Choose the type of build." FORCE)
    set_property (CACHE CMAKE_BUILD_TYPE PROPERTY STRINGS
                  "Debug" "Release" "RelWithDebInfo" "MinSizeRel")
endif ()
set (CMAKE_PREFIX_PATH "" CACHE STRING "External dependencies path")
set (BUILD_SHARED_LIBS "OFF" CACHE BOOL "Build a shared library")

option (ENABLE_MARGO "Build with Margo support" OFF)

# Find required packages
find_package (mercury CONFIG REQUIRED)

if (${ENABLE_MARGO})
  find_package (PkgConfig REQUIRED)
  pkg_check_modules (margo REQUIRED IMPORTED_TARGET margo)
  set (EXTRA_LIBS PkgConfig::margo)
else ()
  set (EXTRA_LIBS)
endif ()

add_subdirectory (src)
add_subdirectory (tests)
